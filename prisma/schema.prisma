// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Partner {
  id           String        @id @default(uuid())
  phone        String        @unique
  role         PartnerRole
  city         String?
  isActive     Boolean       @default(true)
  isAvailable  Boolean       @default(true)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  status       PartnerStatus @default(PENDING)
  address      String?
  businessName String?
  email        String?
  experience   String?
  fullName     String
  partnerType  String
  token        String?       @unique
  
  // Relations
  laundryShop      LaundryShop?
  meatShop         MeatShop?
  designerProfile  DesignerProfile?
  deliveryPartner  DeliveryPartner? // Add this line
  cookProfile      CookProfile? // Add this line
  
  @@map("Partner")
}

// DesignerProfile model
model DesignerProfile {
  id           String   @id @default(uuid())
  partnerId    String   @unique
  bio          String?
  specialties  String[]
  avatar       String?
  coverImage   String?
  experience   String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // Relations
  partner      Partner  @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  portfolio    Design[]
  categories   DesignerCategory[]
  
  @@map("DesignerProfile")
}

model Design {
  id              String   @id @default(uuid())
  designerId      String
  title           String
  description     String?
  category        String
  subcategory     String?
  price           Float
  currency        String   @default("₹")
  images          String[]
  tags            String[]
  isTrending      Boolean  @default(false)
  isNew           Boolean  @default(true)
  likes           Int      @default(0)
  views           Int      @default(0)
  inquiries       Int      @default(0)
  status          String   @default("published")
  fabricType      String?
  deliveryTime    String?
  readyToWear     Boolean  @default(false)
  customizationOptions String[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  designer        DesignerProfile @relation(fields: [designerId], references: [id], onDelete: Cascade)
  
  @@index([designerId])
  @@index([category])
  @@index([isTrending])
  @@map("Design")
}

model DesignerCategory {
  id           String   @id @default(uuid())
  designerId   String
  name         String
  isDefault    Boolean  @default(false)
  displayOrder Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // Relations
  designer     DesignerProfile @relation(fields: [designerId], references: [id], onDelete: Cascade)
  subcategories DesignerSubcategory[]
  
  @@unique([designerId, name])
  @@map("DesignerCategory")
}

model DesignerSubcategory {
  id           String   @id @default(uuid())
  categoryId   String
  name         String
  displayOrder Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // Relations
  category     DesignerCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  items        DesignerItem[]
  
  @@unique([categoryId, name])
  @@map("DesignerSubcategory")
}

model DesignerItem {
  id              String         @id @default(uuid())
  subcategoryId   String
  name            String
  description     String?
  price           Float
  discountPrice   Float?
  currency        String         @default("₹")
  images          String[]
  videos          String[]
  availability    String
  measurements    Json?
  deliveryTime    String?
  customizationTime String?
  isActive        Boolean        @default(true)
  views           Int            @default(0)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  
  // Relations
  subcategory     DesignerSubcategory @relation(fields: [subcategoryId], references: [id], onDelete: Cascade)
  sizes           Size[]
  
  @@index([subcategoryId])
  @@map("DesignerItem")
}

model Size {
  id        String   @id @default(uuid())
  itemId    String
  size      String
  inStock   Boolean  @default(true)
  
  // Relations
  item      DesignerItem @relation(fields: [itemId], references: [id], onDelete: Cascade)
  
  @@unique([itemId, size])
  @@map("Size")
}

model LaundryShop {
  id        String   @id @default(uuid())
  partnerId String   @unique
  shopName  String
  address   String?
  city      String?
  lat       Float?
  lng       Float?
  isOpen    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  partner   Partner  @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  
  @@map("LaundryShop")
}

model MeatShop {
  id        String   @id @default(uuid())
  partnerId String   @unique
  shopName  String
  address   String?
  city      String?
  lat       Float?
  lng       Float?
  isOpen    Boolean  @default(true)
  openTime  String?
  closeTime String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  partner   Partner  @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  items     MeatItem[]
  
  @@map("MeatShop")
}

model MeatItem {
  id          String   @id @default(uuid())
  meatShopId  String
  name        String
  unit        String
  price       Float
  minQty      Float?
  stepQty     Float?
  inStock     Boolean  @default(true)
  imageUrl    String?
  images      String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  shop        MeatShop @relation(fields: [meatShopId], references: [id], onDelete: Cascade)
  
  @@index([meatShopId])
  @@map("MeatItem")
}

// Delivery Partner Models
model DeliveryPartner {
  id              String   @id @default(uuid())
  partnerId       String   @unique
  drivingLicense  String
  vehicleNumber   String
  vehicleType     VehicleType
  vehicleModel    String?
  isVerified      Boolean  @default(false)
  isAvailable     Boolean  @default(true)
  currentLat      Float?
  currentLng      Float?
  lastLocationUpdate DateTime?
  currentOrders   Int      @default(0)
  totalDeliveries Int      @default(0)
  rating          Float    @default(5.0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  partner         Partner  @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  deliveries      Delivery[]
  
  @@index([isAvailable])
  @@index([currentOrders])
  @@map("DeliveryPartner")
}

model Delivery {
  id                  String   @id @default(uuid())
  orderId             String   @unique
  partnerId           String
  customerName        String
  customerPhone       String
  customerAddress     String?
  storeId             String
  storeName           String
  storeAddress        String?
  status              DeliveryStatus
  assignedAt          DateTime? @default(now())
  pickedUpAt          DateTime?
  deliveredAt         DateTime?
  estimatedPickupTime DateTime?
  estimatedDeliveryTime DateTime?
  actualPickupTime    DateTime?
  actualDeliveryTime  DateTime?
  
  // Location tracking
  currentLat          Float?
  currentLng          Float?
  lastLocationUpdate  DateTime?
  
  // Order details
  items               Json
  totalAmount         Float
  
  // Relations
  partner             DeliveryPartner @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  
  @@index([status])
  @@index([partnerId])
  @@map("Delivery")
}

// Enums
enum PartnerStatus {
  PENDING
  APPROVED
  REJECTED
  
  @@map("PartnerStatus")
}

enum PartnerRole {
  LAUNDRY_PARTNER
  MEAT_PARTNER
  TAILOR
  COOK
  DELIVERY
  
  @@map("PartnerRole")
}

enum DeliveryStatus {
  ASSIGNED
  ON_THE_WAY_TO_STORE
  ARRIVED_AT_STORE
  PICKED_UP
  ON_THE_WAY
  ARRIVED
  DELIVERED
  FAILED
  CANCELLED
  
  @@map("DeliveryStatus")
}

enum VehicleType {
  SCOOTY
  BIKE
  CAR
  
  @@map("VehicleType")
}

// Add to your existing schema.prisma

model CookProfile {
  id              String          @id @default(uuid())
  partnerId       String          @unique
  bio             String?
  experience      String?
  tier            CookTier        @default(HOME_COOK)
  pricePerHour    Float?
  pricePerPerson  Float?
  minPeople       Int?
  maxPeople       Int?
  isAvailable     Boolean         @default(true)
  rating          Float           @default(0)
  reviewCount     Int             @default(0)
  avatar          String?
  coverImage      String?
  city            String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  // Relations
  partner         Partner         @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  cuisines        Cuisine[]
  specialties     CookSpecialty[]
  menuItems       CookMenuItem[]
  images          CookImage[]
  bookings        CookBooking[]
  
  @@map("CookProfile")
}

model Cuisine {
  id              String          @id @default(uuid())
  name            String
  cookProfileId   String
  
  // Relations
  cookProfile     CookProfile     @relation(fields: [cookProfileId], references: [id], onDelete: Cascade)
  
  @@unique([cookProfileId, name])
  @@map("Cuisine")
}

model CookSpecialty {
  id              String          @id @default(uuid())
  name            String
  cookProfileId   String
  
  // Relations
  cookProfile     CookProfile     @relation(fields: [cookProfileId], references: [id], onDelete: Cascade)
  
  @@unique([cookProfileId, name])
  @@map("CookSpecialty")
}

model CookImage {
  id              String          @id @default(uuid())
  url             String
  cookProfileId   String
  isCover         Boolean         @default(false)
  createdAt       DateTime        @default(now())
  
  // Relations
  cookProfile     CookProfile     @relation(fields: [cookProfileId], references: [id], onDelete: Cascade)
  
  @@map("CookImage")
}

model CookMenuItem {
  id              String          @id @default(uuid())
  name            String
  description     String?
  price           Float
  category        MenuCategory
  cuisine         String?
  isVegetarian    Boolean         @default(false)
  isVegan         Boolean         @default(false)
  isGlutenFree    Boolean         @default(false)
  isSignature     Boolean         @default(false)
  imageUrl        String?
  cookProfileId   String
  
  // Relations
  cookProfile     CookProfile     @relation(fields: [cookProfileId], references: [id], onDelete: Cascade)
  
  @@index([cookProfileId])
  @@map("CookMenuItem")
}

model CookBooking {
  id              String          @id @default(uuid())
  cookProfileId   String
  customerName    String
  customerPhone   String
  customerAddress String?
  date            DateTime
  timeSlot        String
  numberOfPeople  Int
  specialRequests String?
  totalPrice      Float
  status          BookingStatus   @default(PENDING)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  // Relations
  cookProfile     CookProfile     @relation(fields: [cookProfileId], references: [id], onDelete: Cascade)
  
  @@index([cookProfileId])
  @@index([status])
  @@map("CookBooking")
}

enum CookTier {
  HOME_COOK
  EXPERIENCED
  PROFESSIONAL
  CHEF
  
  @@map("CookTier")
}

enum MenuCategory {
  STARTER
  MAIN_COURSE
  SIDE_DISH
  DESSERT
  BEVERAGE
  BREAD
  RICE
  CURRY
  TANDOOR
  BBQ
  BIRYANI
  THALI
  
  @@map("MenuCategory")
}

enum BookingStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  
  @@map("BookingStatus")
}